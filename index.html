<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PathfinderAI â€” Find Your UK University Programme</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='8' fill='%2300B4D8'/><text x='50%25' y='55%25' text-anchor='middle' dominant-baseline='middle' font-family='sans-serif' font-weight='800' font-size='18' fill='white'>P</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--navy:#0B1D2E;--navy-light:#132D46;--navy-mid:#1A3A5C;--teal:#00B4D8;--teal-dark:#0096B4;--amber:#F4A940;--bg:#F3F6FA;--card:#FFFFFF;--text:#1A2B3C;--text-light:#5A6B7C;--text-muted:#8A9BAC;--border:#E2E8F0;--green:#059669;--green-bg:#D1FAE5;--amber-bg:#FEF3C7;--red:#DC2626;--red-bg:#FEE2E2;--blue-bg:#E0F2FE;--purple-bg:#F3E8FF}
body{font-family:'Sora',sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
.app{width:100%;min-height:100vh;background:var(--bg)}
.onboarding{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(150deg,var(--navy) 0%,var(--navy-light) 40%,var(--navy-mid) 100%);padding:20px;position:relative;overflow:hidden}
.onboarding::before{content:'';position:absolute;top:-40%;right:-20%;width:70%;height:140%;background:radial-gradient(ellipse,rgba(0,180,216,0.07) 0%,transparent 65%);pointer-events:none}
.ob-card{background:rgba(255,255,255,0.025);backdrop-filter:blur(24px);border:1px solid rgba(255,255,255,0.07);border-radius:28px;padding:44px 48px;max-width:580px;width:100%;position:relative;z-index:1}
@media(max-width:640px){.ob-card{padding:28px 24px;border-radius:20px}}
.logo-row{display:flex;align-items:center;gap:11px;margin-bottom:10px}
.logo-sq{width:38px;height:38px;background:linear-gradient(135deg,var(--teal),var(--amber));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;color:#fff;font-weight:800}
.logo-t{font-size:22px;font-weight:700;color:#fff;letter-spacing:-0.5px}
.logo-hi{color:var(--teal)}
.ob-badge{display:inline-block;background:rgba(0,180,216,0.12);color:var(--teal);font-size:11px;font-weight:600;padding:4px 10px;border-radius:6px;margin-bottom:20px;letter-spacing:0.5px}
.ob-sub{font-size:13.5px;color:rgba(255,255,255,0.45);line-height:1.65;margin-bottom:32px}
.fg{margin-bottom:18px}
.fl{display:block;font-size:11px;font-weight:600;color:rgba(255,255,255,0.6);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:7px}
.fi,.fs{width:100%;padding:11px 15px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:11px;color:#fff;font-family:'Sora',sans-serif;font-size:13.5px;outline:none;transition:border 0.2s}
.fi:focus,.fs:focus{border-color:var(--teal)}
.fi::placeholder{color:rgba(255,255,255,0.25)}
.fs option{background:var(--navy);color:#fff}
.fr{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:500px){.fr{grid-template-columns:1fr}}
.chips{display:flex;flex-wrap:wrap;gap:7px}
.chip{padding:7px 15px;border-radius:20px;font-size:12.5px;font-weight:500;border:1px solid rgba(255,255,255,0.13);color:rgba(255,255,255,0.6);cursor:pointer;transition:all 0.2s;background:transparent;font-family:'Sora',sans-serif}
.chip:hover{border-color:var(--teal);color:#fff}
.chip.on{background:rgba(0,180,216,0.13);border-color:var(--teal);color:var(--teal)}
.go-btn{width:100%;padding:14px;border-radius:12px;border:none;background:linear-gradient(135deg,var(--teal),var(--teal-dark));color:#fff;font-family:'Sora',sans-serif;font-size:14.5px;font-weight:600;cursor:pointer;transition:all 0.3s;margin-top:10px}
.go-btn:hover{transform:translateY(-1px);box-shadow:0 8px 28px rgba(0,180,216,0.28)}
.go-btn:disabled{opacity:0.35;cursor:not-allowed;transform:none;box-shadow:none}
.chat{display:flex;flex-direction:column;height:100vh}
.ch-head{display:flex;align-items:center;justify-content:space-between;padding:14px 22px;background:var(--navy);flex-shrink:0;flex-wrap:wrap;gap:8px}
.ch-left{display:flex;align-items:center;gap:10px}
.ch-logo{width:30px;height:30px;background:linear-gradient(135deg,var(--teal),var(--amber));border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;color:#fff;font-weight:800}
.ch-title{font-size:15px;font-weight:600;color:#fff}
.ch-tags{display:flex;gap:8px;font-size:11px;color:rgba(255,255,255,0.45);flex-wrap:wrap}
.ch-tag{background:rgba(255,255,255,0.06);padding:3px 9px;border-radius:5px}
.ch-trust{background:rgba(5,150,105,0.15);color:#34D399;padding:3px 9px;border-radius:5px;font-weight:600;font-size:10px;letter-spacing:0.5px}
.ch-back{background:none;border:1px solid rgba(255,255,255,0.15);color:rgba(255,255,255,0.5);padding:4px 10px;border-radius:6px;font-family:'Sora',sans-serif;font-size:11px;cursor:pointer;transition:all 0.2s;margin-right:4px}
.ch-back:hover{border-color:var(--teal);color:var(--teal)}
.ch-msgs{flex:1;overflow-y:auto;padding:20px 22px;display:flex;flex-direction:column;gap:14px}
.msg{max-width:88%;animation:fadeUp 0.3s ease}
@media(max-width:640px){.msg{max-width:96%}}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.msg.a{align-self:flex-start}.msg.u{align-self:flex-end}
.msg-who{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:0.8px;margin-bottom:5px;color:var(--text-muted)}
.msg.u .msg-who{text-align:right}
.bubble{padding:13px 17px;border-radius:16px;font-size:13.5px;line-height:1.7}
.msg.a .bubble{background:var(--card);border:1px solid var(--border);border-bottom-left-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,0.03)}
.msg.u .bubble{background:var(--navy);color:#fff;border-bottom-right-radius:4px}
.pcards{display:flex;flex-direction:column;gap:14px;margin-top:14px}
.pcard{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;transition:all 0.25s}
.pcard:hover{border-color:var(--teal);box-shadow:0 6px 24px rgba(0,180,216,0.08)}
.pc-top{padding:16px 18px 12px}
.pc-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:3px}
.pc-uni{font-size:11px;font-weight:600;color:var(--teal);text-transform:uppercase;letter-spacing:0.6px}
.pc-rank{font-size:10.5px;color:var(--text-muted);background:var(--bg);padding:2px 8px;border-radius:4px}
.pc-name{font-size:15px;font-weight:600;color:var(--text);margin-bottom:8px;line-height:1.3}
.pc-tags{display:flex;flex-wrap:wrap;gap:5px}
.pc-tag{font-size:10.5px;padding:3px 8px;border-radius:6px;font-weight:500}
.t-fee{background:var(--amber-bg);color:#92400E}.t-city{background:var(--blue-bg);color:#0369A1}.t-dur{background:var(--purple-bg);color:#6B21A8}.t-fnd{background:var(--green-bg);color:#065F46}
.pc-elig{display:flex;align-items:center;gap:6px;padding:7px 12px;margin:8px 18px 0;border-radius:8px;font-size:11.5px;font-weight:600}
.elig-direct{background:var(--green-bg);color:var(--green)}.elig-cond{background:var(--amber-bg);color:#D97706}.elig-below{background:var(--red-bg);color:var(--red)}.elig-unk{background:var(--bg);color:var(--text-muted)}
.pc-tabs{display:flex;border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
.pc-tab{flex:1;padding:8px;text-align:center;font-size:10.5px;font-weight:600;color:var(--text-muted);cursor:pointer;transition:all 0.2s;letter-spacing:0.3px;background:transparent;border:none;font-family:'Sora',sans-serif;border-bottom:2px solid transparent}
.pc-tab:hover{color:var(--text)}.pc-tab.on{color:var(--teal);border-bottom-color:var(--teal)}
.pc-panel{padding:14px 18px}
.pc-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
@media(max-width:500px){.pc-stats{grid-template-columns:repeat(2,1fr)}}
.ps{text-align:center}.ps-v{font-size:17px;font-weight:700;color:var(--navy)}.ps-l{font-size:9.5px;color:var(--text-muted);margin-top:1px}
.slm-box{background:linear-gradient(135deg,#F0FDFA,#ECFDF5);border:1px solid #A7F3D0;border-radius:10px;padding:12px 14px}
.slm-title{font-size:11px;font-weight:700;color:var(--green);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.slm-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:8px}
.slm-stat{text-align:center}.slm-v{font-size:15px;font-weight:700;color:#065F46}.slm-l{font-size:9px;color:#047857}
.slm-note{font-size:11.5px;color:#065F46;line-height:1.5;font-style:italic}
.tc-box{background:linear-gradient(135deg,#FFFBEB,#FEF9E7);border:1px solid #FDE68A;border-radius:10px;padding:12px 14px}
.tc-title{font-size:11px;font-weight:700;color:#92400E;text-transform:uppercase;letter-spacing:0.8px;margin-bottom:10px;display:flex;align-items:center;gap:6px}
.tc-rows{display:flex;flex-direction:column;gap:4px}
.tc-row{display:flex;justify-content:space-between;font-size:12px;color:#78350F;padding:2px 0}
.tc-row.sub{padding-left:12px;color:#A16207;font-size:11.5px}
.tc-divider{border-top:1px dashed #FDE68A;margin:4px 0}
.tc-total{font-weight:700;font-size:13.5px;color:#78350F}
.tc-schol{margin-top:8px;padding:6px 10px;background:rgba(5,150,105,0.08);border-radius:6px;font-size:11px;color:var(--green);display:flex;align-items:center;gap:5px}
.ch-input{padding:14px 22px;background:var(--card);border-top:1px solid var(--border);flex-shrink:0}
.in-row{display:flex;gap:9px}
.in-box{flex:1;padding:11px 15px;border:1px solid var(--border);border-radius:11px;font-family:'Sora',sans-serif;font-size:13.5px;outline:none;background:var(--bg);transition:border 0.2s}
.in-box:focus{border-color:var(--teal)}
.in-btn{padding:11px 18px;border-radius:11px;border:none;background:var(--navy);color:#fff;font-family:'Sora',sans-serif;font-size:13.5px;font-weight:600;cursor:pointer;transition:background 0.2s;white-space:nowrap}
.in-btn:hover{background:var(--navy-light)}.in-btn:disabled{opacity:0.4;cursor:not-allowed}
.quicks{display:flex;flex-wrap:wrap;gap:7px;margin-top:9px}
.qb{padding:5px 13px;border-radius:18px;border:1px solid var(--border);background:var(--card);font-family:'Sora',sans-serif;font-size:11.5px;color:var(--text-light);cursor:pointer;transition:all 0.2s}
.qb:hover{border-color:var(--teal);color:var(--teal)}
.typing{display:flex;gap:4px;padding:13px 17px;background:var(--card);border:1px solid var(--border);border-radius:16px;border-bottom-left-radius:4px;width:fit-content}
.td{width:6px;height:6px;background:var(--text-muted);border-radius:50%;animation:tb 1.2s infinite}
.td:nth-child(2){animation-delay:0.2s}.td:nth-child(3){animation-delay:0.4s}
@keyframes tb{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-5px)}}
.footer{padding:6px 22px 8px;background:var(--card);border-top:1px solid var(--border);text-align:center;font-size:10px;color:var(--text-muted);flex-shrink:0}
.footer a{color:var(--teal);text-decoration:none}
.err-box{margin:8px 0;padding:12px 16px;background:var(--red-bg);border:1px solid #FECACA;border-radius:10px;color:var(--red);font-size:12px}

/* Homepage */
.hp{width:100%;min-height:100vh;background:var(--bg);overflow-x:hidden}
.hp-nav{display:flex;align-items:center;justify-content:space-between;padding:18px 32px;max-width:1200px;margin:0 auto}
.hp-nav-logo{display:flex;align-items:center;gap:10px}
.hp-nav-sq{width:34px;height:34px;background:linear-gradient(135deg,var(--teal),var(--amber));border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px;color:#fff;font-weight:800}
.hp-nav-t{font-size:20px;font-weight:700;color:#fff;letter-spacing:-0.5px}
.hp-nav-t .hi{color:var(--teal)}

.hp-hero{background:linear-gradient(160deg,var(--navy) 0%,#0F2942 50%,var(--navy-mid) 100%);padding:80px 32px 100px;text-align:center;position:relative;overflow:hidden}
.hp-hero::before{content:'';position:absolute;top:-30%;right:-15%;width:60%;height:160%;background:radial-gradient(ellipse,rgba(0,180,216,0.06) 0%,transparent 60%);pointer-events:none}
.hp-hero::after{content:'';position:absolute;bottom:-20%;left:-10%;width:50%;height:100%;background:radial-gradient(ellipse,rgba(244,169,64,0.04) 0%,transparent 60%);pointer-events:none}
.hp-hero-inner{max-width:780px;margin:0 auto;position:relative;z-index:1}
.hp-h1{font-size:42px;font-weight:800;color:#fff;line-height:1.2;letter-spacing:-1px;margin-bottom:20px}
@media(max-width:768px){.hp-h1{font-size:28px}}
.hp-h1-em{color:var(--teal)}
.hp-sub{font-size:17px;color:rgba(255,255,255,0.55);line-height:1.7;max-width:620px;margin:0 auto 36px}
@media(max-width:768px){.hp-sub{font-size:14.5px}}
.hp-cta{display:inline-block;padding:16px 36px;border-radius:14px;border:none;background:linear-gradient(135deg,var(--teal),var(--teal-dark));color:#fff;font-family:'Sora',sans-serif;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s;text-decoration:none}
.hp-cta:hover{transform:translateY(-2px);box-shadow:0 10px 36px rgba(0,180,216,0.3)}
.hp-cta-sec{display:inline-block;margin-top:16px;font-size:14px;color:rgba(255,255,255,0.4);cursor:pointer;transition:color 0.2s;background:none;border:none;font-family:'Sora',sans-serif}
.hp-cta-sec:hover{color:var(--teal)}

.hp-section{max-width:1100px;margin:0 auto;padding:80px 32px}
@media(max-width:768px){.hp-section{padding:56px 20px}}
.hp-section-title{font-size:28px;font-weight:700;color:var(--navy);text-align:center;margin-bottom:12px;letter-spacing:-0.5px}
@media(max-width:768px){.hp-section-title{font-size:22px}}
.hp-section-sub{font-size:15px;color:var(--text-light);text-align:center;margin-bottom:48px;max-width:550px;margin-left:auto;margin-right:auto;line-height:1.6}

.hp-steps{display:grid;grid-template-columns:repeat(3,1fr);gap:32px}
@media(max-width:768px){.hp-steps{grid-template-columns:1fr;gap:24px}}
.hp-step{text-align:center;padding:32px 24px}
.hp-step-num{display:inline-flex;align-items:center;justify-content:center;width:48px;height:48px;border-radius:14px;background:rgba(0,180,216,0.08);color:var(--teal);font-size:20px;font-weight:700;margin-bottom:18px}
.hp-step-title{font-size:17px;font-weight:600;color:var(--navy);margin-bottom:8px}
.hp-step-desc{font-size:13.5px;color:var(--text-light);line-height:1.65}

.hp-diffs{display:grid;grid-template-columns:repeat(3,1fr);gap:24px}
@media(max-width:768px){.hp-diffs{grid-template-columns:1fr;gap:18px}}
.hp-diff{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:28px 24px;transition:all 0.25s}
.hp-diff:hover{border-color:var(--teal);box-shadow:0 8px 28px rgba(0,180,216,0.06)}
.hp-diff-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:16px}
.hp-diff-icon.teal{background:rgba(0,180,216,0.08)}
.hp-diff-icon.amber{background:rgba(244,169,64,0.08)}
.hp-diff-icon.green{background:rgba(5,150,105,0.08)}
.hp-diff-title{font-size:16px;font-weight:600;color:var(--navy);margin-bottom:8px}
.hp-diff-desc{font-size:13px;color:var(--text-light);line-height:1.65}

.hp-proof-bg{background:var(--card);border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
.hp-quotes{display:grid;grid-template-columns:repeat(3,1fr);gap:24px}
@media(max-width:768px){.hp-quotes{grid-template-columns:1fr;gap:18px}}
.hp-quote{background:var(--bg);border:1px solid var(--border);border-radius:16px;padding:24px;position:relative}
.hp-quote-text{font-size:13.5px;color:var(--text);line-height:1.7;margin-bottom:16px;font-style:italic}
.hp-quote-who{font-size:12px;font-weight:600;color:var(--navy)}
.hp-quote-from{font-size:11px;color:var(--text-muted)}
.hp-quote-disc{text-align:center;font-size:11px;color:var(--text-muted);margin-top:24px;font-style:italic}

.hp-teaser{background:var(--navy);border-radius:20px;padding:40px 36px;text-align:center;color:#fff}
@media(max-width:768px){.hp-teaser{padding:28px 20px;border-radius:16px}}
.hp-teaser-title{font-size:18px;font-weight:600;margin-bottom:24px;color:rgba(255,255,255,0.9)}
.hp-teaser-controls{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:28px;flex-wrap:wrap}
.hp-teaser-sel{padding:10px 16px;border-radius:10px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:#fff;font-family:'Sora',sans-serif;font-size:13px;outline:none;cursor:pointer}
.hp-teaser-sel option{background:var(--navy);color:#fff}
.hp-teaser-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;max-width:480px;margin:0 auto 28px}
@media(max-width:500px){.hp-teaser-stats{gap:12px}}
.hp-teaser-stat-val{font-size:28px;font-weight:700;color:var(--teal)}
@media(max-width:500px){.hp-teaser-stat-val{font-size:22px}}
.hp-teaser-stat-lab{font-size:11px;color:rgba(255,255,255,0.5);margin-top:4px}
.hp-teaser-cta{display:inline-block;padding:12px 28px;border-radius:11px;border:1px solid var(--teal);background:transparent;color:var(--teal);font-family:'Sora',sans-serif;font-size:13.5px;font-weight:600;cursor:pointer;transition:all 0.2s}
.hp-teaser-cta:hover{background:var(--teal);color:#fff}

.hp-footer{background:var(--navy);padding:40px 32px;text-align:center}
.hp-footer-inner{max-width:1100px;margin:0 auto}
.hp-footer-brand{font-size:14px;color:rgba(255,255,255,0.5);margin-bottom:8px}
.hp-footer-note{font-size:11px;color:rgba(255,255,255,0.3);margin-bottom:16px;line-height:1.5}
.hp-footer-links{display:flex;justify-content:center;gap:24px;flex-wrap:wrap}
.hp-footer-link{font-size:12px;color:rgba(255,255,255,0.4);cursor:pointer;background:none;border:none;font-family:'Sora',sans-serif;transition:color 0.2s}
.hp-footer-link:hover{color:var(--teal)}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useRef, useEffect } = React;

const API_ENDPOINT = (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') ? null : '/.netlify/functions/chat';

const PROGRAMMES = [
  {id:"P001",uni:"University of Manchester",name:"BSc Business Management",subject:"Business",duration:3,foundation:false,fee:28500,city:"Manchester",region:"North West",qsRank:32,ielts:6.5,aLevel:"AAB",empRate:92,highSkill:71,salary:26000,satisfaction:82,continuation:94,intlPct:42,accreditations:"AACSB, EQUIS, AMBA",scholarship:"Global Futures: Â£5,000/yr",scholarshipVal:5000,livingCost:12000},
  {id:"P002",uni:"University of Manchester",name:"BSc Computer Science",subject:"Computing",duration:3,foundation:false,fee:30000,city:"Manchester",region:"North West",qsRank:32,ielts:6.5,aLevel:"A*AA",empRate:95,highSkill:78,salary:30000,satisfaction:80,continuation:95,intlPct:38,accreditations:"BCS",scholarship:"Dept scholarship: Â£3,000",scholarshipVal:3000,livingCost:12000},
  {id:"P003",uni:"University of Leeds",name:"BA Business Management",subject:"Business",duration:3,foundation:false,fee:27250,city:"Leeds",region:"Yorkshire",qsRank:75,ielts:6.5,aLevel:"AAB",empRate:90,highSkill:68,salary:25000,satisfaction:84,continuation:93,intlPct:35,accreditations:"AACSB, EQUIS, AMBA",scholarship:"Excellence: Â£5,000",scholarshipVal:5000,livingCost:10500},
  {id:"P004",uni:"University of Leeds",name:"BSc Computer Science",subject:"Computing",duration:3,foundation:false,fee:28750,city:"Leeds",region:"Yorkshire",qsRank:75,ielts:6.5,aLevel:"AAA",empRate:93,highSkill:75,salary:28500,satisfaction:81,continuation:94,intlPct:30,accreditations:"BCS",scholarship:"Faculty: Â£3,000",scholarshipVal:3000,livingCost:10500},
  {id:"P005",uni:"University of Exeter",name:"BSc Business and Management",subject:"Business",duration:3,foundation:false,fee:23700,city:"Exeter",region:"South West",qsRank:153,ielts:6.5,aLevel:"AAB",empRate:89,highSkill:67,salary:25500,satisfaction:86,continuation:95,intlPct:30,accreditations:"AACSB, EQUIS",scholarship:"Global Excellence: up to Â£10,000",scholarshipVal:10000,livingCost:10000},
  {id:"P006",uni:"University of Exeter",name:"BSc Computer Science",subject:"Computing",duration:3,foundation:false,fee:28500,city:"Exeter",region:"South West",qsRank:153,ielts:6.5,aLevel:"AAA",empRate:92,highSkill:74,salary:28000,satisfaction:83,continuation:94,intlPct:25,accreditations:"BCS",scholarship:null,scholarshipVal:0,livingCost:10000},
  {id:"P007",uni:"University of Sussex",name:"BSc Business and Management Studies",subject:"Business",duration:3,foundation:false,fee:20000,city:"Brighton",region:"South East",qsRank:218,ielts:6.5,aLevel:"ABB",empRate:87,highSkill:62,salary:24000,satisfaction:79,continuation:90,intlPct:40,accreditations:null,scholarship:"Chancellor's Intl: Â£5,000",scholarshipVal:5000,livingCost:11000},
  {id:"P008",uni:"University of Sussex",name:"BSc Computer Science",subject:"Computing",duration:3,foundation:false,fee:22500,city:"Brighton",region:"South East",qsRank:218,ielts:6.5,aLevel:"ABB",empRate:91,highSkill:72,salary:27000,satisfaction:78,continuation:91,intlPct:35,accreditations:"BCS",scholarship:"Chancellor's Intl: Â£5,000",scholarshipVal:5000,livingCost:11000},
  {id:"P009",uni:"University of Glasgow",name:"BAcc/MA Business & Management",subject:"Business",duration:4,foundation:false,fee:25750,city:"Glasgow",region:"Scotland",qsRank:78,ielts:6.5,aLevel:"AAB-ABB",empRate:91,highSkill:70,salary:25000,satisfaction:85,continuation:93,intlPct:32,accreditations:"AACSB, EQUIS, AMBA",scholarship:"Excellence Award: Â£5,000",scholarshipVal:5000,livingCost:10000},
  {id:"P010",uni:"University of Glasgow",name:"BSc Computing Science",subject:"Computing",duration:4,foundation:false,fee:28420,city:"Glasgow",region:"Scotland",qsRank:78,ielts:6.5,aLevel:"AAB",empRate:94,highSkill:77,salary:29000,satisfaction:82,continuation:94,intlPct:28,accreditations:"BCS",scholarship:"Excellence Award: Â£5,000",scholarshipVal:5000,livingCost:10000},
  {id:"P011",uni:"Coventry University",name:"BA Business Management",subject:"Business",duration:3,foundation:false,fee:16800,city:"Coventry",region:"West Midlands",qsRank:571,ielts:6.0,aLevel:"BCC-BBC",empRate:85,highSkill:55,salary:22000,satisfaction:80,continuation:88,intlPct:48,accreditations:"CMI",scholarship:"Up to Â£2,000",scholarshipVal:2000,livingCost:9500},
  {id:"P012",uni:"Coventry University",name:"BSc Computer Science",subject:"Computing",duration:3,foundation:false,fee:18600,city:"Coventry",region:"West Midlands",qsRank:571,ielts:6.0,aLevel:"BCC-BBC",empRate:88,highSkill:65,salary:25000,satisfaction:77,continuation:87,intlPct:42,accreditations:"BCS",scholarship:"Up to Â£2,000",scholarshipVal:2000,livingCost:9500},
  {id:"P013",uni:"University of Nottingham",name:"BSc Business Management",subject:"Business",duration:3,foundation:false,fee:23760,city:"Nottingham",region:"East Midlands",qsRank:100,ielts:6.5,aLevel:"AAB",empRate:90,highSkill:69,salary:25500,satisfaction:83,continuation:94,intlPct:38,accreditations:"AACSB, EQUIS",scholarship:"Developing Solutions: up to 100% fees",scholarshipVal:23760,livingCost:10000},
  {id:"P014",uni:"University of Nottingham",name:"BSc Computer Science",subject:"Computing",duration:3,foundation:false,fee:28600,city:"Nottingham",region:"East Midlands",qsRank:100,ielts:6.5,aLevel:"A*AA",empRate:94,highSkill:76,salary:29500,satisfaction:81,continuation:95,intlPct:32,accreditations:"BCS",scholarship:"Developing Solutions: up to 100% fees",scholarshipVal:28600,livingCost:10000},
  {id:"P015",uni:"University of Salford",name:"BSc Business Management",subject:"Business",duration:3,foundation:false,fee:15600,city:"Salford",region:"North West",qsRank:801,ielts:6.0,aLevel:"BCC-CCC",empRate:83,highSkill:50,salary:21500,satisfaction:76,continuation:85,intlPct:35,accreditations:null,scholarship:"VC Scholarship: Â£3,000",scholarshipVal:3000,livingCost:10500},
  {id:"P016",uni:"University of Salford",name:"BSc Computer Science",subject:"Computing",duration:3,foundation:false,fee:16500,city:"Salford",region:"North West",qsRank:801,ielts:6.0,aLevel:"BCC-CCC",empRate:86,highSkill:62,salary:24000,satisfaction:74,continuation:84,intlPct:30,accreditations:"BCS",scholarship:"VC Scholarship: Â£3,000",scholarshipVal:3000,livingCost:10500},
  {id:"P017",uni:"Newcastle University",name:"BSc Business Management",subject:"Business",duration:3,foundation:false,fee:24300,city:"Newcastle",region:"North East",qsRank:110,ielts:6.5,aLevel:"AAB",empRate:91,highSkill:68,salary:25000,satisfaction:85,continuation:94,intlPct:30,accreditations:"AACSB, EQUIS, AMBA",scholarship:"Intl Scholarship: Â£3,000",scholarshipVal:3000,livingCost:9500},
  {id:"P018",uni:"Newcastle University",name:"BSc Computer Science",subject:"Computing",duration:3,foundation:false,fee:28400,city:"Newcastle",region:"North East",qsRank:110,ielts:6.5,aLevel:"AAA",empRate:93,highSkill:75,salary:28500,satisfaction:82,continuation:95,intlPct:25,accreditations:"BCS",scholarship:"Intl Scholarship: Â£3,000",scholarshipVal:3000,livingCost:9500},
  {id:"P019",uni:"De Montfort University",name:"BA Business Management",subject:"Business",duration:3,foundation:false,fee:15750,city:"Leicester",region:"East Midlands",qsRank:801,ielts:6.0,aLevel:"BCC-CCC",empRate:84,highSkill:52,salary:21000,satisfaction:78,continuation:86,intlPct:45,accreditations:"CMI",scholarship:"VC Scholarship: Â£2,500",scholarshipVal:2500,livingCost:9000},
  {id:"P020",uni:"De Montfort University",name:"BSc Computer Science",subject:"Computing",duration:3,foundation:false,fee:15750,city:"Leicester",region:"East Midlands",qsRank:801,ielts:6.0,aLevel:"BCC-CCC",empRate:87,highSkill:63,salary:24000,satisfaction:75,continuation:85,intlPct:40,accreditations:"BCS",scholarship:"VC Scholarship: Â£2,500",scholarshipVal:2500,livingCost:9000},
  {id:"P021",uni:"University of Manchester",name:"BSc Business Management with Foundation Year",subject:"Business",duration:4,foundation:true,fee:22000,city:"Manchester",region:"North West",qsRank:32,ielts:5.5,aLevel:"CCC-CCD",empRate:92,highSkill:71,salary:26000,satisfaction:82,continuation:91,intlPct:55,accreditations:"AACSB, EQUIS, AMBA",scholarship:"Foundation bursary: Â£2,000",scholarshipVal:2000,livingCost:12000},
  {id:"P022",uni:"University of Sussex",name:"BSc Computer Science with Foundation Year",subject:"Computing",duration:4,foundation:true,fee:18000,city:"Brighton",region:"South East",qsRank:218,ielts:5.5,aLevel:"CCC-CCD",empRate:91,highSkill:72,salary:27000,satisfaction:78,continuation:88,intlPct:45,accreditations:"BCS",scholarship:"Chancellor's Intl: Â£5,000",scholarshipVal:5000,livingCost:11000},
  {id:"P023",uni:"Coventry University",name:"BA Business Management with Foundation Year",subject:"Business",duration:4,foundation:true,fee:16800,city:"Coventry",region:"West Midlands",qsRank:571,ielts:5.5,aLevel:"CDD-DDD",empRate:85,highSkill:55,salary:22000,satisfaction:80,continuation:85,intlPct:55,accreditations:"CMI",scholarship:"Up to Â£2,000",scholarshipVal:2000,livingCost:9500},
  {id:"P024",uni:"University of Nottingham",name:"BSc Computer Science with Foundation Year",subject:"Computing",duration:4,foundation:true,fee:22000,city:"Nottingham",region:"East Midlands",qsRank:100,ielts:5.5,aLevel:"BCC-CCC",empRate:94,highSkill:76,salary:29500,satisfaction:81,continuation:92,intlPct:45,accreditations:"BCS",scholarship:"Developing Solutions: up to 100% fees",scholarshipVal:22000,livingCost:10000},
  {id:"P025",uni:"De Montfort University",name:"BSc Computer Science with Foundation Year",subject:"Computing",duration:4,foundation:true,fee:15750,city:"Leicester",region:"East Midlands",qsRank:801,ielts:5.5,aLevel:"DDD-DD",empRate:87,highSkill:63,salary:24000,satisfaction:75,continuation:82,intlPct:50,accreditations:"BCS",scholarship:"VC Scholarship: Â£2,500",scholarshipVal:2500,livingCost:9000},
  {id:"P026",uni:"University of Birmingham",name:"BSc Business Management",subject:"Business",duration:3,foundation:false,fee:24120,city:"Birmingham",region:"West Midlands",qsRank:80,ielts:6.5,aLevel:"AAA-AAB",empRate:91,highSkill:70,salary:26000,satisfaction:84,continuation:95,intlPct:35,accreditations:"AACSB, EQUIS, AMBA",scholarship:"Birmingham Scholarship: Â£2,000",scholarshipVal:2000,livingCost:10500},
  {id:"P027",uni:"University of Birmingham",name:"BSc Computer Science",subject:"Computing",duration:3,foundation:false,fee:28800,city:"Birmingham",region:"West Midlands",qsRank:80,ielts:6.5,aLevel:"A*AA",empRate:94,highSkill:77,salary:29500,satisfaction:82,continuation:96,intlPct:30,accreditations:"BCS",scholarship:"Birmingham Scholarship: Â£2,000",scholarshipVal:2000,livingCost:10500},
  {id:"P028",uni:"University of Sheffield",name:"BSc Business Management",subject:"Business",duration:3,foundation:false,fee:23250,city:"Sheffield",region:"Yorkshire",qsRank:105,ielts:6.5,aLevel:"AAB",empRate:90,highSkill:67,salary:25000,satisfaction:83,continuation:93,intlPct:33,accreditations:"AACSB, EQUIS, AMBA",scholarship:"Intl Merit: 25-50% of fees",scholarshipVal:11625,livingCost:9500},
  {id:"P029",uni:"University of Sheffield",name:"BSc Computer Science",subject:"Computing",duration:3,foundation:false,fee:28500,city:"Sheffield",region:"Yorkshire",qsRank:105,ielts:6.5,aLevel:"AAA",empRate:93,highSkill:76,salary:29000,satisfaction:80,continuation:94,intlPct:28,accreditations:"BCS",scholarship:"Intl Merit: 25-50% of fees",scholarshipVal:14250,livingCost:9500},
  {id:"P030",uni:"University of Salford",name:"BSc Business Management with Foundation Year",subject:"Business",duration:4,foundation:true,fee:15600,city:"Salford",region:"North West",qsRank:801,ielts:5.5,aLevel:"DDD-DD",empRate:83,highSkill:50,salary:21500,satisfaction:76,continuation:82,intlPct:42,accreditations:null,scholarship:"VC Scholarship: Â£3,000",scholarshipVal:3000,livingCost:10500}
];

const COUNTRIES_DATA = {"Nigeria":{quals:"WAEC/NECO O-Levels, UTME",ieltsRange:"5.0-6.5",budgetSens:"High",englishLevel:"Moderate",flightCost:650,visaCost:490,ihsCost:1035,communityFactor:"Strong Nigerian student communities at Coventry, DMU, Manchester, Nottingham"},"India":{quals:"CBSE/ISC Class 12",ieltsRange:"5.5-7.0",budgetSens:"High",englishLevel:"Moderate-High",flightCost:550,visaCost:490,ihsCost:1035,communityFactor:"Large Indian student populations at Birmingham, Manchester, Sheffield, Glasgow"},"China":{quals:"Gaokao, A-Levels",ieltsRange:"5.0-6.5",budgetSens:"Moderate",englishLevel:"Low-Moderate",flightCost:750,visaCost:490,ihsCost:1035,communityFactor:"Established Chinese communities at Manchester, Glasgow, Birmingham, Nottingham"},"Pakistan":{quals:"HSC/Intermediate, A-Levels",ieltsRange:"5.0-6.5",budgetSens:"High",englishLevel:"Moderate",flightCost:500,visaCost:490,ihsCost:1035,communityFactor:"Strong Pakistani communities at Manchester, Leeds, Coventry"},"Bangladesh":{quals:"HSC, A-Levels",ieltsRange:"5.0-6.0",budgetSens:"Very High",englishLevel:"Low-Moderate",flightCost:600,visaCost:490,ihsCost:1035,communityFactor:"Growing communities at Coventry, DMU Leicester, Salford"},"Ghana":{quals:"WASSCE, A-Levels",ieltsRange:"5.0-6.5",budgetSens:"High",englishLevel:"Moderate",flightCost:600,visaCost:490,ihsCost:1035,communityFactor:"Active Ghanaian societies at many UK universities"},"Saudi Arabia":{quals:"Tawjihi",ieltsRange:"5.0-6.0",budgetSens:"Low (if gov sponsored)",englishLevel:"Low",flightCost:450,visaCost:490,ihsCost:1035,communityFactor:"Islamic societies and prayer facilities at most UK universities"},"Vietnam":{quals:"High School Diploma",ieltsRange:"5.0-6.0",budgetSens:"High",englishLevel:"Low",flightCost:700,visaCost:490,ihsCost:1035,communityFactor:"Growing Vietnamese communities at Manchester, Leeds, Glasgow"},"Kenya":{quals:"KCSE Certificate",ieltsRange:"5.5-6.5",budgetSens:"High",englishLevel:"Moderate-High",flightCost:550,visaCost:490,ihsCost:1035,communityFactor:"Kenyan student networks at Nottingham, Manchester, Leeds, Newcastle"},"Turkey":{quals:"Lise Diplomasi",ieltsRange:"5.0-6.5",budgetSens:"Moderate",englishLevel:"Moderate",flightCost:250,visaCost:490,ihsCost:1035,communityFactor:"Turkish societies at many Russell Group universities"}};

const OUTCOME_SIMS = {"Nigeria":{high:{empRate:88,salary:24500,highSkill:65,note:"Nigerian graduates from top-50 UK unis report strong outcomes in finance and consulting"},mid:{empRate:84,salary:22000,highSkill:58,note:"Many Nigerian graduates from mid-ranked UK unis enter management and operations roles"},accessible:{empRate:80,salary:20000,highSkill:48,note:"Nigerian graduates from accessible unis often pursue further study or enter SME management"}},"India":{high:{empRate:91,salary:28000,highSkill:72,note:"Indian graduates from top-50 UK unis are highly sought after in tech and financial services"},mid:{empRate:87,salary:25000,highSkill:64,note:"Indian graduates from mid-ranked UK unis report strong outcomes in IT and business analytics"},accessible:{empRate:83,salary:22000,highSkill:55,note:"Indian graduates from accessible unis often find roles in IT support, operations, and consulting"}},"China":{high:{empRate:85,salary:26000,highSkill:68,note:"Chinese graduates from top-50 UK unis often return to China with strong salary premiums"},mid:{empRate:81,salary:23000,highSkill:60,note:"Chinese graduates from mid-ranked UK unis report good outcomes in finance and marketing"},accessible:{empRate:77,salary:20500,highSkill:50,note:"Chinese graduates from accessible unis often leverage UK degree for roles at multinationals in China"}},"Pakistan":{high:{empRate:87,salary:24000,highSkill:63,note:"Pakistani graduates from top-50 UK unis find opportunities in banking, consulting and tech"},mid:{empRate:83,salary:21500,highSkill:56,note:"Pakistani graduates from mid-ranked UK unis often enter business management and IT roles"},accessible:{empRate:79,salary:19500,highSkill:47,note:"Pakistani graduates from accessible unis pursue roles in administration, marketing, and IT support"}}};
const DEFAULT_OUTCOME = {high:{empRate:87,salary:25000,highSkill:66,note:"International graduates from top UK universities report strong employment outcomes"},mid:{empRate:83,salary:22500,highSkill:58,note:"International graduates from mid-ranked universities enter diverse professional roles"},accessible:{empRate:79,salary:20000,highSkill:49,note:"International graduates from accessible universities benefit from UK work experience via Graduate Route"}};

function getOutcome(c, r) { const d = OUTCOME_SIMS[c] || DEFAULT_OUTCOME; if (r <= 120) return d.high; if (r <= 400) return d.mid; return d.accessible; }
function getTotalCost(p, c) { const cd = COUNTRIES_DATA[c]; const fl = cd ? cd.flightCost : 600; const ihs = cd ? cd.ihsCost : 1035; const sv = p.scholarshipVal || 0; return { annual: p.fee + p.livingCost - sv, total: (p.fee + p.livingCost - sv) * p.duration + fl + 490 + ihs * p.duration, flight: fl, visa: 490, ihs, totalBefore: (p.fee + p.livingCost + ihs) * p.duration + fl + 490 }; }
function getElig(p, s) { const i = parseFloat(s); if (isNaN(i)) return { st:"unk", label:"IELTS needed", cls:"elig-unk" }; if (i >= p.ielts) return { st:"ok", label:"Direct entry", cls:"elig-direct" }; if (i >= p.ielts - 0.5) return { st:"cond", label:"Conditional â€” may need pre-sessional English", cls:"elig-cond" }; return { st:"low", label:"Below requirement â€” foundation year or IELTS retake needed", cls:"elig-below" }; }

const COUNTRY_LIST = ["Nigeria","India","China","Pakistan","Bangladesh","Ghana","Saudi Arabia","Vietnam","Kenya","Turkey","Brazil","Indonesia","Thailand","Malaysia","Sri Lanka","Nepal","Egypt","Iran","Colombia","Mexico","Philippines","South Korea","Japan","Taiwan","Hong Kong","UAE","Kuwait","Oman","Qatar","Jordan","Other"];

function buildSys(p) {
  const cd = COUNTRIES_DATA[p.country];
  const progs = PROGRAMMES.map(x => ({id:x.id,uni:x.uni,name:x.name,subject:x.subject,fee:x.fee,city:x.city,qsRank:x.qsRank,ielts:x.ielts,aLevel:x.aLevel,empRate:x.empRate,highSkill:x.highSkill,salary:x.salary,satisfaction:x.satisfaction,foundation:x.foundation,duration:x.duration,scholarship:x.scholarship,scholarshipVal:x.scholarshipVal,livingCost:x.livingCost}));
  return "You are PathfinderAI, an expert university advisor helping international students find the right UK undergraduate programme. You work for the STUDENT, not the universities. You are warm, honest, and genuinely invested.\n\nSTUDENT PROFILE:\n- Country: " + p.country + "\n- Subject: " + p.subject + "\n- Qualifications: " + p.qualifications + "\n- IELTS: " + (p.ielts || "Not yet taken") + "\n- Budget: " + p.budget + "\n- Priorities: " + p.priorities + (cd ? "\n\nCOUNTRY CONTEXT:\n- Typical quals: " + cd.quals + "\n- IELTS range: " + cd.ieltsRange + "\n- Budget sensitivity: " + cd.budgetSens + "\n- Community: " + cd.communityFactor + "\n- Flight: Â£" + cd.flightCost + ", Visa: Â£" + cd.visaCost + ", IHS/yr: Â£" + cd.ihsCost : "") + "\n\nPROGRAMME DATABASE:\n" + JSON.stringify(progs) + "\n\nRULES:\n1. Start by acknowledging the student and asking 1-2 clarifying questions. Do NOT recommend in your first message.\n2. When ready, include: |||PROGRAMMES|||[\"P001\",\"P013\"]|||END|||\n3. Be OUTCOME-LED. Reference employment rates, salaries, what students from their country experience.\n4. Be HONEST about trade-offs.\n5. Consider TOTAL COST: fees + living + visa + IHS + flights - scholarship.\n6. Suggest foundation year if IELTS/quals are below direct entry.\n7. Reference country context and community.\n8. Mention the 2-year Graduate Route visa.\n9. Keep under 300 words. Be conversational.\n10. Never recommend based on university payments. You work for the student.";
}

function parseMsg(text) {
  const m = text.match(/\|\|\|PROGRAMMES\|\|\|(.*?)\|\|\|END\|\|\|/s);
  let progs = []; let clean = text;
  if (m) { try { progs = JSON.parse(m[1]); } catch(e) {} clean = text.replace(/\|\|\|PROGRAMMES\|\|\|.*?\|\|\|END\|\|\|/s, '').trim(); }
  return { text: clean, programmes: progs };
}

function ProgrammeCard({ progId, country, ielts }) {
  const [tab, setTab] = useState('outcomes');
  const p = PROGRAMMES.find(x => x.id === progId);
  if (!p) return null;
  const el = getElig(p, ielts);
  const oc = getOutcome(country, p.qsRank);
  const tc = getTotalCost(p, country);
  const tier = p.qsRank <= 120 ? 'top-tier' : p.qsRank <= 400 ? 'mid-ranked' : 'accessible';
  const sv = p.scholarshipVal || 0;

  return (
    <div className="pcard">
      <div className="pc-top">
        <div className="pc-header">
          <span className="pc-uni">{p.uni}</span>
          <span className="pc-rank">QS #{p.qsRank}</span>
        </div>
        <div className="pc-name">{p.name}</div>
        <div className="pc-tags">
          <span className="pc-tag t-fee">{"Â£" + p.fee.toLocaleString() + "/yr"}</span>
          <span className="pc-tag t-city">{p.city}</span>
          <span className="pc-tag t-dur">{p.duration + " yrs"}</span>
          {p.foundation && <span className="pc-tag t-fnd">Foundation Year</span>}
        </div>
      </div>
      <div className={"pc-elig " + el.cls}>
        <span>{el.st === 'ok' ? 'âœ“' : el.st === 'cond' ? 'âš ' : el.st === 'low' ? 'âœ—' : '?'}</span>
        {" " + el.label}
      </div>
      <div className="pc-tabs">
        <button className={"pc-tab" + (tab === 'outcomes' ? ' on' : '')} onClick={() => setTab('outcomes')}>Outcomes</button>
        <button className={"pc-tab" + (tab === 'students' ? ' on' : '')} onClick={() => setTab('students')}>Students Like Me</button>
        <button className={"pc-tab" + (tab === 'cost' ? ' on' : '')} onClick={() => setTab('cost')}>Total Cost</button>
      </div>
      <div className="pc-panel">
        {tab === 'outcomes' && (
          <div className="pc-stats">
            <div className="ps"><div className="ps-v">{p.empRate + "%"}</div><div className="ps-l">Employed</div></div>
            <div className="ps"><div className="ps-v">{p.highSkill + "%"}</div><div className="ps-l">Graduate jobs</div></div>
            <div className="ps"><div className="ps-v">{"Â£" + (p.salary/1000).toFixed(0) + "k"}</div><div className="ps-l">Median salary</div></div>
            <div className="ps"><div className="ps-v">{p.satisfaction + "%"}</div><div className="ps-l">Satisfaction</div></div>
          </div>
        )}
        {tab === 'students' && (
          <div className="slm-box">
            <div className="slm-title"><span>ðŸ‘¤</span>{" " + (country || 'International') + " graduates from " + tier + " UK universities"}</div>
            <div className="slm-stats">
              <div className="slm-stat"><div className="slm-v">{oc.empRate + "%"}</div><div className="slm-l">Employed</div></div>
              <div className="slm-stat"><div className="slm-v">{"Â£" + (oc.salary/1000).toFixed(1) + "k"}</div><div className="slm-l">Avg salary</div></div>
              <div className="slm-stat"><div className="slm-v">{oc.highSkill + "%"}</div><div className="slm-l">Grad-level jobs</div></div>
            </div>
            <div className="slm-note">{oc.note}</div>
          </div>
        )}
        {tab === 'cost' && (
          <div className="tc-box">
            <div className="tc-title"><span>ðŸ’°</span>{" Total cost of attendance (" + p.duration + " years)"}</div>
            <div className="tc-rows">
              <div className="tc-row"><span>{"Tuition (" + p.duration + " yrs)"}</span><span>{"Â£" + (p.fee * p.duration).toLocaleString()}</span></div>
              <div className="tc-row"><span>{"Living costs (" + p.duration + " yrs)"}</span><span>{"Â£" + (p.livingCost * p.duration).toLocaleString()}</span></div>
              <div className="tc-row sub"><span>Visa</span><span>{"Â£" + tc.visa}</span></div>
              <div className="tc-row sub"><span>{"IHS (" + p.duration + " yrs)"}</span><span>{"Â£" + (tc.ihs * p.duration).toLocaleString()}</span></div>
              <div className="tc-row sub"><span>Est. flights</span><span>{"Â£" + tc.flight}</span></div>
              <div className="tc-divider"></div>
              <div className="tc-row tc-total"><span>Total before scholarship</span><span>{"Â£" + tc.totalBefore.toLocaleString()}</span></div>
              {sv > 0 && <div className="tc-row" style={{color:'#059669'}}><span>{"Scholarship (" + p.duration + " yrs)"}</span><span>{"-Â£" + (sv * p.duration).toLocaleString()}</span></div>}
              {sv > 0 && <div className="tc-divider"></div>}
              {sv > 0 && <div className="tc-row tc-total"><span>Total after scholarship</span><span>{"Â£" + tc.total.toLocaleString()}</span></div>}
            </div>
            {p.scholarship && <div className="tc-schol"><span>ðŸŽ“</span>{" " + p.scholarship}</div>}
          </div>
        )}
      </div>
    </div>
  );
}

// Teaser stats by country/subject for the homepage
const TEASER_STATS = {
  "Nigeria": { "Business": { empRate: 84, salary: 22, gradLevel: 58 }, "Computing": { empRate: 87, salary: 25, gradLevel: 64 } },
  "India": { "Business": { empRate: 87, salary: 25, gradLevel: 64 }, "Computing": { empRate: 91, salary: 28, gradLevel: 72 } },
  "China": { "Business": { empRate: 81, salary: 23, gradLevel: 60 }, "Computing": { empRate: 85, salary: 26, gradLevel: 68 } },
  "Pakistan": { "Business": { empRate: 83, salary: 21, gradLevel: 56 }, "Computing": { empRate: 87, salary: 24, gradLevel: 63 } },
  "Bangladesh": { "Business": { empRate: 80, salary: 20, gradLevel: 50 }, "Computing": { empRate: 84, salary: 23, gradLevel: 58 } },
  "Ghana": { "Business": { empRate: 82, salary: 21, gradLevel: 54 }, "Computing": { empRate: 86, salary: 24, gradLevel: 62 } },
  "Kenya": { "Business": { empRate: 83, salary: 22, gradLevel: 57 }, "Computing": { empRate: 87, salary: 25, gradLevel: 64 } },
};
const DEFAULT_TEASER = { "Business": { empRate: 83, salary: 22, gradLevel: 58 }, "Computing": { empRate: 87, salary: 25, gradLevel: 66 } };

function Homepage({ onStart, onScrollHow }) {
  const [teaserCountry, setTeaserCountry] = useState('Nigeria');
  const [teaserSubject, setTeaserSubject] = useState('Business');
  const howRef = useRef(null);

  const tData = (TEASER_STATS[teaserCountry] || DEFAULT_TEASER)[teaserSubject] || DEFAULT_TEASER[teaserSubject];

  const scrollToHow = () => {
    if (howRef.current) howRef.current.scrollIntoView({ behavior: 'smooth' });
  };

  return (
    <div className="hp">
      {/* Hero */}
      <div className="hp-hero">
        <div className="hp-nav">
          <div className="hp-nav-logo">
            <div className="hp-nav-sq">P</div>
            <div className="hp-nav-t">Pathfinder<span className="hi">AI</span></div>
          </div>
        </div>
        <div className="hp-hero-inner">
          <h1 className="hp-h1">Find the right UK university.<br/><span className="hp-h1-em">Not the one that pays us to say so.</span></h1>
          <p className="hp-sub">AI-powered guidance built on real graduate outcomes, true total costs, and what actually happened to students like you.</p>
          <button className="hp-cta" onClick={onStart}>Start your free assessment</button>
          <br/>
          <button className="hp-cta-sec" onClick={scrollToHow}>See how it works &#8595;</button>
        </div>
      </div>

      {/* How It Works */}
      <div className="hp-section" ref={howRef}>
        <div className="hp-section-title">How it works</div>
        <p className="hp-section-sub">Three steps to guidance that actually puts you first.</p>
        <div className="hp-steps">
          <div className="hp-step">
            <div className="hp-step-num">1</div>
            <div className="hp-step-title">Tell us about you</div>
            <div className="hp-step-desc">5 minutes of questions so we understand your situation, not just your grades.</div>
          </div>
          <div className="hp-step">
            <div className="hp-step-num">2</div>
            <div className="hp-step-title">See what's real</div>
            <div className="hp-step-desc">Graduate outcomes, true total costs, and what happened to students from your country.</div>
          </div>
          <div className="hp-step">
            <div className="hp-step-num">3</div>
            <div className="hp-step-title">Get honest guidance</div>
            <div className="hp-step-desc">AI that tells you when a cheaper option is just as good. No commission, no bias.</div>
          </div>
        </div>
      </div>

      {/* Differentiators */}
      <div className="hp-section" style={{paddingTop: 0}}>
        <div className="hp-section-title">What makes this different</div>
        <p className="hp-section-sub">Built on what students actually need to know.</p>
        <div className="hp-diffs">
          <div className="hp-diff">
            <div className="hp-diff-icon teal">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#00B4D8" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            </div>
            <div className="hp-diff-title">Students Like Me</div>
            <div className="hp-diff-desc">See graduate outcomes for students from your country at every university tier. Employment rates, salaries, career paths â€” data nobody else shows you.</div>
          </div>
          <div className="hp-diff">
            <div className="hp-diff-icon amber">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#F4A940" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
            </div>
            <div className="hp-diff-title">True Total Cost</div>
            <div className="hp-diff-desc">Tuition is just the start. We calculate visa fees, health surcharge, flights, living costs, and realistic scholarship chances. The real number, not the brochure number.</div>
          </div>
          <div className="hp-diff">
            <div className="hp-diff-icon green">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#059669" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
            </div>
            <div className="hp-diff-title">Honest Trade-offs</div>
            <div className="hp-diff-desc">If a Â£16k/year university delivers the same career outcomes as a Â£30k one, we'll tell you. Our AI works for you, not the universities.</div>
          </div>
        </div>
      </div>

      {/* Social Proof */}
      <div className="hp-proof-bg">
        <div className="hp-section">
          <div className="hp-section-title">What students discovered</div>
          <p className="hp-section-sub">Real insights that changed real decisions.</p>
          <div className="hp-quotes">
            <div className="hp-quote">
              <div className="hp-quote-text">"I was set on Manchester until PathfinderAI showed me Sheffield's scholarship would save me Â£35k with nearly identical outcomes."</div>
              <div className="hp-quote-who">Adebayo</div>
              <div className="hp-quote-from">Nigeria</div>
            </div>
            <div className="hp-quote">
              <div className="hp-quote-text">"Nobody told me about the Immigration Health Surcharge. PathfinderAI showed me the true cost was Â£15k more than I thought."</div>
              <div className="hp-quote-who">Priya</div>
              <div className="hp-quote-from">India</div>
            </div>
            <div className="hp-quote">
              <div className="hp-quote-text">"I didn't know I needed a foundation year. PathfinderAI caught it and found me one at a top-100 university."</div>
              <div className="hp-quote-who">Chen Wei</div>
              <div className="hp-quote-from">China</div>
            </div>
          </div>
          <div className="hp-quote-disc">Sample testimonials for demonstration purposes</div>
        </div>
      </div>

      {/* Country Teaser */}
      <div className="hp-section">
        <div className="hp-teaser">
          <div className="hp-teaser-title">What happens to international students in the UK?</div>
          <div className="hp-teaser-controls">
            <span style={{fontSize:'13px',color:'rgba(255,255,255,0.5)'}}>Students from</span>
            <select className="hp-teaser-sel" value={teaserCountry} onChange={e => setTeaserCountry(e.target.value)}>
              {['Nigeria','India','China','Pakistan','Bangladesh','Ghana','Kenya'].map(c =>
                <option key={c} value={c}>{c}</option>
              )}
            </select>
            <span style={{fontSize:'13px',color:'rgba(255,255,255,0.5)'}}>studying</span>
            <select className="hp-teaser-sel" value={teaserSubject} onChange={e => setTeaserSubject(e.target.value)}>
              <option value="Business">Business</option>
              <option value="Computing">Computing</option>
            </select>
          </div>
          <div className="hp-teaser-stats">
            <div>
              <div className="hp-teaser-stat-val">{tData.empRate}%</div>
              <div className="hp-teaser-stat-lab">Employment rate</div>
            </div>
            <div>
              <div className="hp-teaser-stat-val">Â£{tData.salary}k</div>
              <div className="hp-teaser-stat-lab">Median salary</div>
            </div>
            <div>
              <div className="hp-teaser-stat-val">{tData.gradLevel}%</div>
              <div className="hp-teaser-stat-lab">Graduate-level jobs</div>
            </div>
          </div>
          <button className="hp-teaser-cta" onClick={onStart}>See your personalised results â†’</button>
        </div>
      </div>

      {/* Footer */}
      <div className="hp-footer">
        <div className="hp-footer-inner">
          <div className="hp-footer-brand">PathfinderAI is a prototype by Hyphen Education Group</div>
          <div className="hp-footer-note">Outcome data modelled from HESA Graduate Outcomes</div>
          <div className="hp-footer-links">
            <button className="hp-footer-link" onClick={scrollToHow}>How it works</button>
            <button className="hp-footer-link" onClick={onStart}>Start assessment</button>
          </div>
        </div>
      </div>
    </div>
  );
}

function App() {
  const [currentView, setCurrentView] = useState('home');
  const [profile, setProfile] = useState({country:'',subject:'',qualifications:'',ielts:'',budget:'',priorities:''});
  const [msgs, setMsgs] = useState([]);
  const [input, setInput] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [selPri, setSelPri] = useState([]);
  const endRef = useRef(null);
  useEffect(() => { if (endRef.current) endRef.current.scrollIntoView({behavior:'smooth'}); }, [msgs, loading]);

  const budgets = [{l:"Under Â£20k/yr",v:"Under Â£20,000/yr total"},{l:"Â£20-30k/yr",v:"Â£20,000-Â£30,000/yr total"},{l:"Â£30-40k/yr",v:"Â£30,000-Â£40,000/yr total"},{l:"Â£40k+/yr",v:"Over Â£40,000/yr"}];
  const priorities = ["University ranking","Graduate salary","Lower fees","City life","Career support","Scholarships"];
  const togPri = (p) => setSelPri(prev => prev.includes(p) ? prev.filter(x=>x!==p) : prev.length<3 ? [...prev,p] : prev);
  const canGo = profile.country && profile.subject && profile.qualifications && profile.budget && selPri.length > 0;

  const callAI = async (history, prof) => {
    setLoading(true); setError(null);
    try {
      const endpoint = API_ENDPOINT || 'https://api.anthropic.com/v1/messages';
      const res = await fetch(endpoint, { method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:1000,system:buildSys(prof||profile),messages:history.map(m=>({role:m.role,content:m.content}))}) });
      const data = await res.json();
      if (data.error) { setError(data.error.message || "API error"); setLoading(false); return; }
      const text = data.content ? data.content.map(c => c.text || '').join('') : "Having trouble connecting. Please try again.";
      setMsgs(prev => [...prev, {role:'assistant', content:text, parsed:parseMsg(text)}]);
    } catch(e) { console.error(e); setError("Connection failed â€” check the Netlify function and API key."); }
    setLoading(false);
  };

  const launch = async () => {
    const fp = {...profile, priorities: selPri.join(', ')};
    setProfile(fp);
    const intro = "Hi! I'm from " + fp.country + ". I want to study " + fp.subject + " in the UK. My qualifications: " + fp.qualifications + ". " + (fp.ielts ? "IELTS: " + fp.ielts + "." : "Haven't taken IELTS yet.") + " Budget: " + fp.budget + ". Most important: " + fp.priorities + ".";
    setMsgs([{role:'user',content:intro,parsed:{text:intro,programmes:[]}}]);
    setCurrentView('chat');
    await callAI([{role:'user',content:intro}], fp);
  };

  const send = async () => {
    if (!input.trim() || loading) return;
    const nm = [...msgs, {role:'user',content:input.trim(),parsed:{text:input.trim(),programmes:[]}}];
    setMsgs(nm); setInput('');
    await callAI(nm.map(m=>({role:m.role,content:m.content})), profile);
  };

  const quick = async (t) => {
    const nm = [...msgs, {role:'user',content:t,parsed:{text:t,programmes:[]}}];
    setMsgs(nm);
    await callAI(nm.map(m=>({role:m.role,content:m.content})), profile);
  };

  const restart = () => { setCurrentView('home'); setMsgs([]); setProfile({country:'',subject:'',qualifications:'',ielts:'',budget:'',priorities:''}); setSelPri([]); setError(null); };

  // Homepage (default landing)
  if (currentView === 'home') return (
    <Homepage onStart={() => setCurrentView('profile')} />
  );

  // Profile / onboarding (existing form â€” will be replaced by Profile Builder in v2)
  if (currentView === 'profile') return (
    <div className="app"><div className="onboarding"><div className="ob-card">
      <div className="logo-row"><div className="logo-sq">P</div><div className="logo-t">Pathfinder<span className="logo-hi">AI</span></div></div>
      <div className="ob-badge">POWERED BY OUTCOME DATA</div>
      <div className="ob-sub">Honest, outcome-led guidance to find the right UK programme. We show you what actually happens to students like you â€” real graduate data, true total costs, no hidden agendas.</div>
      <div className="fg"><label className="fl">Where are you from?</label><select className="fs" value={profile.country} onChange={e => setProfile(p=>({...p,country:e.target.value}))}><option value="">Select your country</option>{COUNTRY_LIST.map(c => <option key={c} value={c}>{c}</option>)}</select></div>
      <div className="fg"><label className="fl">What do you want to study?</label><select className="fs" value={profile.subject} onChange={e => setProfile(p=>({...p,subject:e.target.value}))}><option value="">Select subject area</option><option value="Business & Management">Business & Management</option><option value="Computer Science & IT">Computer Science & IT</option><option value="Not sure yet">Not sure yet</option></select></div>
      <div className="fr">
        <div className="fg"><label className="fl">Your qualifications</label><input className="fi" placeholder="e.g. A-Levels BBB, WAEC" value={profile.qualifications} onChange={e => setProfile(p=>({...p,qualifications:e.target.value}))} /></div>
        <div className="fg"><label className="fl">IELTS score (if taken)</label><input className="fi" placeholder="e.g. 6.0 or not taken" value={profile.ielts} onChange={e => setProfile(p=>({...p,ielts:e.target.value}))} /></div>
      </div>
      <div className="fg"><label className="fl">Annual budget (fees + living)</label><div className="chips">{budgets.map(b => <button key={b.l} className={"chip"+(profile.budget===b.v?' on':'')} onClick={()=>setProfile(p=>({...p,budget:b.v}))}>{b.l}</button>)}</div></div>
      <div className="fg"><label className="fl">What matters most? (pick up to 3)</label><div className="chips">{priorities.map(p => <button key={p} className={"chip"+(selPri.includes(p)?' on':'')} onClick={()=>togPri(p)}>{p}</button>)}</div></div>
      <button className="go-btn" disabled={!canGo} onClick={launch}>Find my programmes â†’</button>
    </div></div></div>
  );

  // Chat view
  return (
    <div className="app"><div className="chat">
      <div className="ch-head">
        <div className="ch-left">
          <button className="ch-back" onClick={restart}>â† Home</button>
          <div className="ch-logo">P</div>
          <div className="ch-title">Pathfinder<span className="logo-hi">AI</span></div>
        </div>
        <div className="ch-tags"><span className="ch-trust">WORKS FOR YOU</span><span className="ch-tag">{profile.country}</span><span className="ch-tag">{profile.subject}</span></div>
      </div>
      <div className="ch-msgs">
        {msgs.map((m, i) => (
          <div key={i} className={"msg " + (m.role==='assistant'?'a':'u')}>
            <div className="msg-who">{m.role==='assistant'?'PathfinderAI':'You'}</div>
            <div className="bubble">
              {m.parsed && m.parsed.text && m.parsed.text.split('\n').map((line, j) => <span key={j}>{line}<br/></span>)}
              {m.parsed && m.parsed.programmes && m.parsed.programmes.length > 0 && (
                <div className="pcards">{m.parsed.programmes.map(pid => <ProgrammeCard key={pid} progId={pid} country={profile.country} ielts={profile.ielts} />)}</div>
              )}
            </div>
          </div>
        ))}
        {loading && <div className="msg a"><div className="msg-who">PathfinderAI</div><div className="typing"><div className="td"></div><div className="td"></div><div className="td"></div></div></div>}
        {error && <div className="err-box">{error}</div>}
        <div ref={endRef}></div>
      </div>
      <div className="ch-input">
        <div className="in-row">
          <input className="in-box" placeholder="Ask me anything about studying in the UK..." value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter'&&send()} disabled={loading} />
          <button className="in-btn" onClick={send} disabled={loading||!input.trim()}>Send</button>
        </div>
        {msgs.length <= 2 && <div className="quicks">
          <button className="qb" onClick={()=>quick('What are the most affordable options with good outcomes?')}>Best value</button>
          <button className="qb" onClick={()=>quick('Show me the real total cost of each option')}>True total costs</button>
          <button className="qb" onClick={()=>quick('Do I need a foundation year?')}>Foundation year?</button>
          <button className="qb" onClick={()=>quick('What happened to students from my country at these universities?')}>Students like me</button>
          <button className="qb" onClick={()=>quick("Is a more expensive university worth it?")}>Worth the cost?</button>
        </div>}
      </div>
      <div className="footer">PathfinderAI prototype â€” Outcome data modelled from <a href="https://www.hesa.ac.uk" target="_blank">HESA</a> Graduate Outcomes. Not for production use.</div>
    </div></div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
